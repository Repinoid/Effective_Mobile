# Subscription Management API

REST API для управления подписками пользователей с валидацией UUID и уникальными комбинациями user_id + service_name.

## Основные допущения

1. **ID пользователя** должен быть в формате UUID (проверяется валидация)
2. **Уникальность комбинации**: пара `user_id` + `service_name` уникальна
   - Один пользователь может подписаться на сервис только один раз
   - Для изменения параметров существующей подписки использовать UPDATE
3. **CRUDL-архитектура** с полным набором операций

## Эндпоинты

### Добавление подписки
`POST /add`  
Добавляет новую запись о подписке в таблицу.

**Параметры запроса** (JSON):
- `user_id` (обязательный) - UUID пользователя
- `service_name` (обязательный) - название сервиса
- `start_date` - (обязательный) дата начала подписки
- `end_date` - дата окончания подписки
- `cost` - (обязательный) стоимость подписки

### Чтение подписок
`POST /read`  
Возвращает список подписок с фильтрацией.

**Параметры запроса** (JSON):
- `user_id` (обязательный) - UUID пользователя
- `service_name` (обязательный) - название сервиса
- `start_date` / `end_date` - диапазон дат (фильтр: start_date ≤ дата ≤ end_date)

### Обновление подписки
`PUT /update`  
Обновляет существующую запись о подписке.

**Параметры запроса** (JSON):
- `user_id` (обязательный) - UUID пользователя
- `service_name` (обязательный) - название сервиса
- Любые другие поля для обновления

### Удаление подписок
`DELETE /delete`  
Удаляет записи по маске параметров.

**Внимание**:  
- Пустой JSON-запрос удалит ВСЕ записи
- Поля в запросе действуют как фильтр для удаления

### Полный список подписок
`GET /list`  
Возвращает все подписки без фильтрации.

### Суммарная стоимость
`POST /sum`  
Вычисляет общую стоимость подписок с возможностью фильтрации.

**Параметры фильтрации** (JSON):
- `user_id` - фильтр по пользователю
- `service_name` - фильтр по сервису
- `start_date` / `end_date` - диапазон дат

## Тестирование

### Unit-тесты
```bash
# Тесты функций БД
go test ./internal/dbase

# Тесты HTTP-хендлеров
go test ./internal/handlera


### Интеграционные тесты
Запустите сервис:

bash
docker compose build --no-cache && docker compose up -d
# или
docker compose up -d
Выполните тесты:

bash
go test ./cmd/app -count=1
Технологии тестирования
Фреймворк: github.com/stretchr/testify/suite

Тестовые контейнеры: github.com/testcontainers/testcontainers-go

Вспомогательные сервисы:

PgAdmin (доступен как третий контейнер)

PgBouncer (не используется в текущей конфигурации)

CI/CD
Готов шаблон GitHub Actions из другого проекта (может быть подключен при необходимости)













Допущения<hr>

1. ID пользователя в формате UUID - надо проверять на соответствие<br>
2. Комбинация user_id & service_name уникальна. Один user_id может подписаться на service_name один раз, если надо ещё - через UPDATE<br>
3. CRUDL. <br>
POST **/add**  -  добавить в таблицу запись о подписке<br>
POST **/read** -  Выдаёт список запросов<br>
В запросе обязательны только user_id & service_name, наличие остальных параметров (дат) выступает как маска start_date <= дата <= end_date <br>
PUT **/update**  -  обязательны user_id & service_name, остальное - обновляет запись<br>
DELETE **/delete**  -  поля в JSON запроса - маска. Скажем, если JSON пустой - удалит ***всё***<br><br>
GET **/list**  - вернёт список  всех подписок<br>
POST **/sum** - суммарная стоимость подписок, фильтрация по названию и/или user_id и диапазону дат <br>
<hr>

Код писался параллельно с тестами, *github.com/stretchr/testify/suite*<br>
База для тестов поднимается *github.com/testcontainers/testcontainers-go*<br>

***go test ./internal/dbase*** тест функций БД<br>
***go test ./internal/handlera*** тест HTTP хандлеров БД<br>

Для интеграционных тестов необходимо собрать проект и запустить сервис <br>
***docker compose build --no-cache && docker compose up -d***<br>
или просто запустить<br>
***docker compose up -d***<br>

***go test ./cmd/app -count=1***<br>

Третьим контейнером запускается ***PgAdmin***, ***PgBouncer*** не стал подключать<br>

Можно ещё и CD github actions внедрить, шаблон есть из другого проекта<br>

```
Тестовое задание Junior Golang Developer
Effective Mobile
Задача: спроектировать и реализовать REST-сервис для агрегации данных об
онлайн-подписках пользователей.
Требования:
1. Выставить HTTP-ручки для CRUDL-операций над записями о подписках. Каждая запись
содержит:
1. Название сервиса, предоставляющего подписку
2. Стоимость месячной подписки в рублях
3. ID пользователя в формате UUID
4. Дата начала подписки (месяц и год)
5. Опционально дата окончания подписки
2. Выставить HTTP-ручку для подсчета суммарной стоимости всех подписок за выбранный
период с фильтрацией по id пользователя и названию подписки
3. СУБД – PostgreSQL. Должны быть миграции для инициализации базы данных
4. Покрыть код логами
5. Вынести конфигурационные данные в .env/.yaml-файл
6. Предоставить swagger-документацию к реализованному API
7. Запуск сервиса с помощью docker compose
Примечания:
1. Проверка существования пользователя не требуется. Управление пользователями вне
зоны ответственности вашего сервиса
2. Стоимость любой подписки – целое число рублей, копейки не учитываются
Пример тела запроса на создание записи о подписке:

{
“service_name”: “Yandex Plus”,
“price”: 400,
“user_id”: “60601fee-2bf1-4721-ae6f-7636e79a0cba”,
“start_date”: “07-2025”
}
```





