# Subscription Management API

## REST API для управления подписками пользователей 

## Основные допущения

1. **ID пользователя** должен быть в формате UUID (проверяется валидация)
2. **Уникальность комбинации**: пара `user_id` + `service_name` уникальна
   - Один пользователь может подписаться на сервис только один раз
   - Для изменения параметров существующей подписки использовать UPDATE
3. **CRUDL-архитектура** с полным набором операций

# Документация API (Swagger)
## API документировано с использованием Swagger (OpenAPI 3.0). 

**Доступ к документации доступен по следующим путям:**
- `/swagger`- HTML-интерфейс Swagger UI
- `/swagger.json` - Спецификация API в формате JSON
- `/swagger.yaml` - Спецификация API в формате YAML

# Для локального запуска документации:

- Запустите сервер
- Откройте в браузере `http://localhost:8080/swagger`


## Эндпоинты CRUDL

## CREATE
### Добавление подписки
`POST /add`  
Добавляет новую запись о подписке в таблицу.

**Параметры запроса** (JSON):
- `user_id` (обязательный) - UUID пользователя
- `service_name` (обязательный) - название сервиса
- `start_date` - (обязательный) дата начала подписки
- `end_date` - дата окончания подписки
- `cost` - (обязательный) стоимость подписки

## READ
### Чтение подписок
`POST /read`  
Возвращает список подписок с фильтрацией.

**Параметры запроса** (JSON):
- `user_id` (обязательный) - UUID пользователя
- `service_name` (обязательный) - название сервиса
- `start_date` / `end_date` - диапазон дат (фильтр: start_date ≤ дата ≤ end_date)

## UPDATE
### Обновление подписки
`PUT /update`  
Обновляет существующую запись о подписке.

**Параметры запроса** (JSON):
- `user_id` (обязательный) - UUID пользователя
- `service_name` (обязательный) - название сервиса
- Любые другие поля для обновления

## DELETE
### Удаление подписок
`DELETE /delete`  
Удаляет записи по маске параметров.

**Внимание**:  
- Пустой JSON-запрос удалит ВСЕ записи
- Поля в запросе действуют как фильтр для удаления

## LIST
### Полный список подписок
`GET /list?page=1&pageSize=20`  
- Возвращает все подписки.
- Page - номер страницы, опционально
- pageSize - количество записей на странице
<hr>
### Суммарная стоимость
`POST /sum`  
Вычисляет общую стоимость подписок с возможностью фильтрации.

**Параметры фильтрации** (JSON):
- `user_id` - фильтр по пользователю
- `service_name` - фильтр по сервису
- `start_date` / `end_date` - диапазон дат

## Тестирование

## Unit-тесты

### Тесты функций БД
`go test ./internal/dbase`

### Тесты HTTP-хендлеров
`go test ./internal/handlera`


## Интеграционные тесты
Запустите сервис:
`docker compose build --no-cache && docker compose up -d`

### или
`docker compose up -d`

### Выполните тесты:

`go test ./cmd/app -count=1`

### Технологии тестирования
- Фреймворк: `github.com/stretchr/testify/suite`
- Тестовые контейнеры: `github.com/testcontainers/testcontainers-go`

### Вспомогательные сервисы:
- `PgAdmin` (доступен как третий контейнер на **8088** порту)
- `PgBouncer` (не используется в текущей конфигурации)

### CI/CD
- Готов шаблон `GitHub Actions` из другого проекта (может быть подключен при необходимости)


```
Тестовое задание Junior Golang Developer
Effective Mobile
Задача: спроектировать и реализовать REST-сервис для агрегации данных об
онлайн-подписках пользователей.
Требования:
1. Выставить HTTP-ручки для CRUDL-операций над записями о подписках. Каждая запись
содержит:
1. Название сервиса, предоставляющего подписку
2. Стоимость месячной подписки в рублях
3. ID пользователя в формате UUID
4. Дата начала подписки (месяц и год)
5. Опционально дата окончания подписки
2. Выставить HTTP-ручку для подсчета суммарной стоимости всех подписок за выбранный
период с фильтрацией по id пользователя и названию подписки
3. СУБД – PostgreSQL. Должны быть миграции для инициализации базы данных
4. Покрыть код логами
5. Вынести конфигурационные данные в .env/.yaml-файл
6. Предоставить swagger-документацию к реализованному API
7. Запуск сервиса с помощью docker compose
Примечания:
1. Проверка существования пользователя не требуется. Управление пользователями вне
зоны ответственности вашего сервиса
2. Стоимость любой подписки – целое число рублей, копейки не учитываются
Пример тела запроса на создание записи о подписке:

{
“service_name”: “Yandex Plus”,
“price”: 400,
“user_id”: “60601fee-2bf1-4721-ae6f-7636e79a0cba”,
“start_date”: “07-2025”
}
```





+ неподходящий тип данных для хранения в БД (varchar вместо uuid)
- почти нет info логов
+ нет пагинации в запросах на получение списка
+ в подсчете суммы не учитывается количество месяцев подписки
? реализованы не все CRUDL-операции

+ не обработан случай обновления/удаления несуществующей подписки
+ лишние файлы/папки в репозитории (.vscode)
+ не используются интерфейсы